var $jq=jQuery.noConflict(),J3=J3||{};J3.HTMLtoWord=function(){var GenerateWordFile=function(params,done){null==params&&done(!1);var MIME_Head='MIME-Version: 1.0\r\nContent-Type: multipart/related; boundary="----=_NextPart_ZROIIZO.ZCZYUACXV.ZARTUI"\r\n\r\n',MIME_Document_Head='Content-Location: file:///C:/document.htm\r\nContent-Transfer-Encoding: base64\r\nContent-Type: text/html; charset="utf-8"\r\n\r\n',MIME_Header_Head='Content-Location: file:///C:/document_files/headerfooter.htm\r\nContent-Transfer-Encoding: base64\r\nContent-Type: text/html; charset="utf-8"\r\n\r\n',MIME_Header_Head2='Content-Location: file:///C:/document_files/headerfooter2.htm\r\nContent-Transfer-Encoding: base64\r\nContent-Type: text/html; charset="utf-8"\r\n\r\n',MIME_Header_TESTAttachment='Content-Location: file:///C:/document_files/test.txt\r\nContent-Transfer-Encoding: base64\r\nContent-Type: text/html; charset="utf-8"\r\n\r\n',Boundary="------=_NextPart_ZROIIZO.ZCZYUACXV.ZARTUI\r\n",lastBoundary="------=_NextPart_ZROIIZO.ZCZYUACXV.ZARTUI--",FileDoc="",FileHead="";params=setParameters(params);var BodyTemplate=generateTemplateBody(params),HeadFooterTemplates=generateTemplateHeadFooter(params),HeadFooterTemplate1=HeadFooterTemplates[0],HeadFooterTemplate2=HeadFooterTemplates.length>1?HeadFooterTemplates[1]:"";imageBodyParser(BodyTemplate,function(returnBody){var FileDoc=returnBody.replace(/{{PageNum}}/g,generatePagingTemplate(params)).replace(/{{TOC}}/g,generateTableOfContents(params));imageBodyParser(HeadFooterTemplate1,function(returnHead1){var FileHead=returnHead1.replace(/{{PageNum}}/g,generatePagingTemplate(params));imageBodyParser(HeadFooterTemplate2,function(returnHead2){var FileHead2=returnHead2.replace(/{{PageNum}}/g,generatePagingTemplate(params)),ReplaceFootNotes=addFootNotes(FileDoc,params.FootNotes);FileDoc=ReplaceFootNotes.Body.replace(/{{FootNotes}}/g,ReplaceFootNotes.Footnotes);var FileDocBase64=btoa(unescape(encodeURIComponent(FileDoc)))+"\r\n\r\n",FileHeadBase64=btoa(unescape(encodeURIComponent(FileHead)))+"\r\n\r\n",FileHead2Base64=""!=FileHead2?btoa(unescape(encodeURIComponent(FileHead2)))+"\r\n\r\n":"",testFile=btoa(unescape(encodeURIComponent("asdasdasdasdasdasf as fsa df")))+"\r\n\r\n",str,FileDocBlob=new Blob([MIME_Head+Boundary+MIME_Document_Head+FileDocBase64+Boundary+MIME_Header_Head+FileHeadBase64+Boundary+(""!=FileHead2?MIME_Header_Head2:"")+(""!=FileHead2?FileHead2Base64:"")+(""!=FileHead2?Boundary:"")+MIME_Header_TESTAttachment+testFile+lastBoundary],{type:"application/msword;charset=utf-8"});params.Download&&saveAs(FileDocBlob,params.FileName+".doc"),done(FileDocBlob)})})})},setParameters=function(params){var parameters={},Title="";if(null==params.FileName||""==params.FileName?(""!=$jq(document).find("title").text()?parameters.FileName=$jq(document).find("title").text():(parameters.FileName=window.location.pathname.split("/").pop(),parameters.FileName.indexOf(".")>-1&&(parameters.FileName=parameters.FileName.split(".")[0])),Title=parameters.FileName,parameters.FileName+="_"+((new Date).getMonth()+1)+"-"+(new Date).getDate()+"-"+(new Date).getFullYear()):(parameters.FileName=params.FileName,Title=parameters.FileName),parameters.FileName=parameters.FileName.replace(/[\|&;\$%@"<>\(\)\+,]/g,""),parameters.Title=null==params.Title?Title:params.Title,parameters.Orientation=null==params.Orientation?"portrait":params.Orientation,parameters.Size=null==params.Size?"8.5in 11in":params.Size,parameters.Margin=null==params.Margin?"1in 1in 1in 1in":params.Margin,parameters.HeaderMargin=null==params.HeaderMargin?".1in":params.HeaderMargin,parameters.FooterMargin=null==params.FooterMargin?".5in":params.FooterMargin,parameters.PageNumberText1=null==params.PageNumberText1?"Page":params.PageNumberText1,parameters.PageNumberText2=null==params.PageNumberText2?"of":params.PageNumberText2,parameters.PageNumberText3=null==params.PageNumberText3?"":params.PageNumberText3,parameters.TOCTitle=null==params.TOCTitle?"Table of Contents":params.TOCTitle,parameters.Download=null==params.Download||params.Download,parameters.HeaderFooters=[],parameters.Pages=[],parameters.FootNotes=[],parameters.Pages=null==params.Pages?[""]:""==params.Pages?[""]:params.Pages,null==params.HeaderFooters)parameters.HeaderFooters=[];else if(params.HeaderFooters.length>0)for(var i=0;i<params.HeaderFooters.length;i++)parameters.HeaderFooters.push({Header:null!=params.HeaderFooters[i].Header?params.HeaderFooters[i].Header:"",Footer:null!=params.HeaderFooters[i].Footer?params.HeaderFooters[i].Footer:""});else parameters.HeaderFooters=[];return parameters.FootNotes=null==params.FootNotes?[]:""==params.FootNotes?[]:params.FootNotes,parameters},imageBodyParser=function(body,callback){var newBody=$jq(body),totalImg=$jq(body).find("img").length;if(totalImg>0){var totalConverted=0;$jq(newBody).find("img").each(function(index,e){var imgBase64="",width=e.width,height=e.height;image_to_base64(e.src,width,height,function(result){if(imgBase64=result,e.src=imgBase64,++totalConverted==totalImg){for(var returnText="",i=0;i<newBody.length;i++)null!=newBody[i].outerHTML?returnText+=newBody[i].outerHTML:3==newBody[i].nodeType&&(returnText+=newBody[i].textContent);callback(returnText)}})})}else callback(body)},image_to_base64=function(file,fwidth,fheight,callback){var httpRequest=new XMLHttpRequest;httpRequest.onload=function(){var fileReader=new FileReader;fileReader.onloadend=function(){if(0==fwidth&&0==fheight)callback(fileReader.result);else{var img=new Image;img.src=fileReader.result,img.onload=function(){var newWidth,newHeight;fwidth>0&&0==fheight?(newWidth=calculateAspectRatioFit(this.width,this.height,fwidth,this.height).width,newHeight=calculateAspectRatioFit(this.width,this.height,fwidth,this.height).height):0==fwidth&&fheight>0?(newWidth=calculateAspectRatioFit(this.width,this.height,this.width,fheight).width,newHeight=calculateAspectRatioFit(this.width,this.height,this.width,fheight).height):(newWidth=fwidth,newHeight=fheight);var img=document.createElement("img");img.src=fileReader.result,img.width=newWidth,img.height=newHeight;var canvas=document.createElement("canvas"),ctx,ctx;(ctx=canvas.getContext("2d")).drawImage(img,0,0),canvas.width=newWidth,canvas.height=newHeight,(ctx=canvas.getContext("2d")).drawImage(img,0,0,newWidth,newHeight);var dataurl=canvas.toDataURL("image/png");callback(dataurl)}}},fileReader.readAsDataURL(httpRequest.response)},httpRequest.open("GET",file),httpRequest.responseType="blob",httpRequest.send()},generateTemplateBody=function(DocParams){var TemplateDoc="";TemplateDoc+='<head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><title>'+DocParams.Title+'</title><link rel=File-List href="document_files/filelist.xml">  <style>  v:* {behavior:url(#default#VML);}  o:* {behavior:url(#default#VML);}  w:* {behavior:url(#default#VML);}  .shape {behavior:url(#default#VML);}  </style>  <style>  p.MsoHeader, li.MsoHeader, div.MsoHeader{  margin:0in;  margin-top:.0001pt;  mso-pagination:widow-orphan;  tab-stops:center 3.0in right 6.0in;  }  p.MsoFooter, li.MsoFooter, div.MsoFooter{  margin:0in;  margin-bottom:.0001pt;  mso-pagination:widow-orphan;  tab-stops:center 3.0in right 6.0in;  }  p.MsoTocHeading, li.MsoTocHeading, div.MsoTocHeading  {mso-style-priority:39;  mso-style-qformat:yes;  mso-style-parent:"Heading 1";  mso-style-next:Normal;  margin-top:12.0pt;  margin-right:0in;  margin-bottom:0in;  margin-left:0in;  margin-bottom:.0001pt;  line-height:107%;  mso-pagination:widow-orphan lines-together;  page-break-after:avoid;  font-size:16.0pt;  font-family:"Calibri Light",sans-serif;  mso-ascii-font-family:"Calibri Light";  mso-ascii-theme-font:major-latin;  mso-fareast-font-family:"Times New Roman";  mso-fareast-theme-font:major-fareast;  mso-hansi-font-family:"Calibri Light";  mso-hansi-theme-font:major-latin;  mso-bidi-font-family:"Times New Roman";  mso-bidi-theme-font:major-bidi;  color:#2F5496;  mso-themecolor:accent1;  mso-themeshade:191;}p.MsoFootnoteText, li.MsoFootnoteText, div.MsoFootnoteText{  mso-style-noshow:yes; mso-style-priority:99; so-style-link:"Footnote Text Char"; margin:0in; margin-bottom:.0001pt; mso-pagination:widow-orphan; font-size:10.0pt; font-family:"Calibri",sans-serif; mso-ascii-font-family:Calibri; mso-ascii-theme-font:minor-latin; mso-fareast-font-family:Calibri; mso-fareast-theme-font:minor-latin; mso-hansi-font-family:Calibri; mso-hansi-theme-font:minor-latin; mso-bidi-font-family:"Times New Roman"; mso-bidi-theme-font:minor-bidi;}span.MsoFootnoteReference{  mso-style-noshow:yes;  mso-style-priority:99;  vertical-align:super;}span.FootnoteTextChar{  mso-style-name:"Footnote Text Char"; mso-style-noshow:yes; mso-style-priority:99; mso-style-unhide:no; mso-style-locked:yes; mso-style-link:"Footnote Text"; mso-ansi-font-size:10.0pt; mso-bidi-font-size:10.0pt;} @page  {  mso-page-orientation: '+DocParams.Orientation+";  size:"+DocParams.Size+";  margin:"+DocParams.Margin+';  mso-footnote-separator:url("document_files/headerfooter.htm") fs;\t mso-footnote-continuation-separator:url("document_files/headerfooter.htm") fcs;\t mso-endnote-separator:url("document_files/headerfooter.htm") es;\t mso-endnote-continuation-separator:url("document_files/headerfooter.htm") ecs;}  }  @page Section1 {  mso-header-margin:'+DocParams.HeaderMargin+";  mso-footer-margin:"+DocParams.FooterMargin+";  mso-title-page: yes;",2==DocParams.HeaderFooters.length?TemplateDoc+=' mso-first-header: url("document_files/headerfooter.htm") h1; mso-first-footer: url("document_files/headerfooter.htm") f1; mso-header: url("document_files/headerfooter2.htm") h2; mso-footer: url("document_files/headerfooter2.htm") f2;':TemplateDoc+='mso-first-header: url("document_files/headerfooter.htm") h1;mso-first-footer: url("document_files/headerfooter.htm") f1;',TemplateDoc+=' mso-paper-source:0; } div.Section1 { page: Section1; } </style> <xml>  <word:WordDocument>  <word:View>Print</word:View>  <word:Zoom>90</word:Zoom>  <word:DoNotOptimizeForBrowser />  </word:WordDocument> </xml></head><body>  <div class="Section1">';for(var i=0;i<DocParams.Pages.length;i++)TemplateDoc+=DocParams.Pages[i],i<DocParams.Pages.length-1&&(TemplateDoc+='<br clear="all" style="page-break-before:always" />');return TemplateDoc+="  </div>{{FootNotes}}</body>"},generateTemplateHeadFooter=function(DocParams){var FootNoteTemplateSeparator="<div style='mso-element:footnote-separator' id=fs> <p class=MsoNormal><span style='mso-special-character:footnote-separator'><![if !supportFootnotes]> <hr align=left size=1 width=\"33%\"><![endif]></span></p>  </div>  <div style='mso-element:footnote-continuation-separator' id=fcs> <p class=MsoNormal><span style='mso-special-character:footnote-continuation-separator'><![if !supportFootnotes]> <hr align=left size=1><![endif]></span></p>  </div>  <div style='mso-element:endnote-separator' id=es> <p class=MsoNormal><span style='mso-special-character:footnote-separator'><![if !supportFootnotes]> <hr align=left size=1 width=\"33%\"><![endif]></span></p>  </div>  <div style='mso-element:endnote-continuation-separator' id=ecs> <p class=MsoNormal><span style='mso-special-character:footnote-continuation-separator'><![if !supportFootnotes]> <hr align=left size=1><![endif]></span></p>  </div>",templates=[];if(0==DocParams.HeaderFooters.length)templates.push('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"= xmlns="http://www.w3.org/TR/REC-html40"><body>'+FootNoteTemplateSeparator+'<div style="mso-element:header;" id="h1"><p class=MsoHeader></p></div><div style=\'mso-element:footer\' id=f1><p class=MsoFooter></p></div></body></html>');else for(var i=0;i<DocParams.HeaderFooters.length;i++)templates.push('<html xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns:m="http://schemas.microsoft.com/office/2004/12/omml"= xmlns="http://www.w3.org/TR/REC-html40"><body>'+FootNoteTemplateSeparator+'<div style="mso-element:header;" id="h'+(i+1)+'"><p class=MsoHeader>'+(null!=DocParams.HeaderFooters[i].Header?DocParams.HeaderFooters[i].Header:"")+"</p></div><div style='mso-element:footer' id=f"+(i+1)+"><p class=MsoFooter>"+(null!=DocParams.HeaderFooters[i].Footer?DocParams.HeaderFooters[i].Footer:"")+"</p></div></body></html>");return templates},generatePagingTemplate=function(parameters,pagerNum){return PagingTemplate="<span class=SpellE></span> "+(null==parameters.PageNumberText1?"Page":parameters.PageNumberText1)+" \x3c!--[if supportFields]><span class=MsoPageNumber><span style='mso-element:field-begin'></span><span style='mso-spacerun:yes'> </span>PAGE <span style='mso-element:field-separator'></span></span><![endif]--\x3e<span class=MsoPageNumber><span style='mso-no-proof:yes'>1</span></span>\x3c!--[if supportFields]><span class=MsoPageNumber><span style='mso-element:field-end'></span></span><![endif]--\x3e<span class=MsoPageNumber> "+(null==parameters.PageNumberText2?"of":parameters.PageNumberText2)+" </span>\x3c!--[if supportFields]><span class=MsoPageNumber><span style='mso-element:field-begin'></span> NUMPAGES <span style='mso-element:field-separator'></span></span><![endif]--\x3e<span class=MsoPageNumber><span style='mso-no-proof:yes'>1</span></span>\x3c!--[if supportFields]><span class=MsoPageNumber><span style='mso-element:field-end'></span></span>"+(null==parameters.PageNumberText3?"of":parameters.PageNumberText3)+"<![endif]--\x3e"},generateTableOfContents=function(parameters){return'<w:Sdt SdtDocPart="t" DocPartType="Table of Contents" DocPartUnique="t" ID="489288532"> <p class=MsoTocHeading>'+parameters.TOCTitle+"<w:sdtPr></w:sdtPr></p> <p class=MsoNormal>\x3c!--[if supportFields]><span style='mso-element:field-begin'></span><span style='mso-spacerun:yes'></span> TOC \\o &quot;1-3&quot; \\h \\z \\u <span style='mso-element:field-separator'></span><![endif]--\x3e<b><span style='mso-no-proof:yes'>Please select the \"Update Table\" button to refresh the table.</span></b>\x3c!--[if supportFields]><b><span style='mso-no-proof:yes'><span style='mso-element:field-end'></span></span></b><![endif]--\x3e</p> </w:Sdt>"},calculateAspectRatioFit=function(srcWidth,srcHeight,maxWidth,maxHeight){var ratio=Math.min(maxWidth/srcWidth,maxHeight/srcHeight);return{width:srcWidth*ratio,height:srcHeight*ratio}},addFootNotes=function(Body,FootNotesArray){if(FootNotesArray.length>0){for(var numFootnotes=($jq(Body).text().match(/{{FootNote}}/g)||[]).length,BodyReturn=Body,FootNotesString="<div style='mso-element:footnote-list'><![if !supportFootnotes]><br clear=all><hr align=left size=1 width=\"33%\"><![endif]>",i=0;i<numFootnotes;i++){var footnoteReference="<a style='mso-footnote-id:ftn"+(i+1)+"' href=\"#_ftn"+(i+1)+'" name="_ftnref'+(i+1)+'"  title=""><span class=MsoFootnoteReference><span style=\'mso-special-character: footnote\'><![if !supportFootnotes]><span class=MsoFootnoteReference><span style=\'font-size:12.0pt;font-family:"Times New Roman",serif;mso-fareast-font-family:"Times New Roman";mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA\'>['+(i+1)+"]</span></span><![endif]></span></span></a>";BodyReturn=BodyReturn.replace("{{FootNote}}",footnoteReference),FootNotesString+="<div style='mso-element:footnote' id=ftn"+(i+1)+"><p class=MsoFootnoteText><a style='mso-footnote-id:ftn"+(i+1)+"' href=\"#_ftnref"+(i+1)+'" name="_ftn'+(i+1)+'" title=""><span class=MsoFootnoteReference><span style=\'mso-special-character:footnote\'><![if !supportFootnotes]><span class=MsoFootnoteReference><span style=\'font-size:10.0pt;font-family:"Times New Roman",serif;mso-fareast-font-family:"Times New Roman";mso-fareast-theme-font:minor-fareast;mso-ansi-language:EN-US;mso-fareast-language:EN-US;mso-bidi-language:AR-SA\'>['+(i+1)+"]</span></span><![endif]></span></span></a>"+FootNotesArray[i]+"</p></div>"}return{Body:BodyReturn,Footnotes:FootNotesString+="</div>"}}return{Body:Body,Footnotes:""}};return{GenerateWordFile:GenerateWordFile,setParameters:setParameters,imageBodyParser:imageBodyParser,image_to_base64:image_to_base64,generateTemplateHeadFooter:generateTemplateHeadFooter,calculateAspectRatioFit:calculateAspectRatioFit,generatePagingTemplate:generatePagingTemplate,generateTableOfContents:generateTableOfContents,addFootNotes:addFootNotes}}();